{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://raw.githubusercontent.com/simorgh3196/tsuzulint/main/schemas/v1/rule.json",
  "title": "TsuzuLint Rule Manifest",
  "description": "Schema for tsuzulint-rule.json - Rule distribution manifest",
  "type": "object",
  "required": [
    "rule",
    "wasm"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema URL for validation and IDE support"
    },
    "rule": {
      "type": "object",
      "description": "Rule metadata",
      "required": [
        "name",
        "version"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "Unique rule identifier. Supports multilingual names (Japanese, Chinese, Korean, etc.). Must not contain whitespace, control characters, or path separators (/, \\, .).",
          "minLength": 1,
          "maxLength": 64,
          "pattern": "^[^\\s\\x00-\\x1F\\x7F-\\x9F/\\\\.]{1,64}$",
          "examples": [
            "no-todo",
            "sentence-length",
            "no-doubled-joshi",
            "敬語チェック",
            "句子长度",
            "문장길이"
          ]
        },
        "version": {
          "type": "string",
          "description": "Semantic version",
          "pattern": "^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?$",
          "examples": [
            "1.0.0",
            "2.1.0-beta.1"
          ]
        },
        "description": {
          "type": "string",
          "description": "Human-readable description of the rule"
        },
        "repository": {
          "type": "string",
          "format": "uri",
          "description": "GitHub repository URL",
          "examples": [
            "https://github.com/simorgh3196/tsuzulint-rule-no-doubled-joshi"
          ]
        },
        "license": {
          "type": "string",
          "description": "License identifier (SPDX format recommended)",
          "examples": [
            "MIT",
            "Apache-2.0",
            "GPL-3.0-only"
          ]
        },
        "authors": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of authors (format: 'Name <email>')",
          "examples": [
            [
              "Tomoya Hayakawa <simorgh3196@gmail.com>"
            ]
          ]
        },
        "keywords": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Search keywords",
          "examples": [
            [
              "japanese",
              "grammar",
              "joshi"
            ]
          ]
        },
        "fixable": {
          "type": "boolean",
          "default": false,
          "description": "Whether this rule can provide auto-fixes"
        },
        "node_types": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "Document",
              "Paragraph",
              "Header",
              "BlockQuote",
              "List",
              "ListItem",
              "CodeBlock",
              "HorizontalRule",
              "Html",
              "Table",
              "TableRow",
              "TableCell",
              "Str",
              "Break",
              "Emphasis",
              "Strong",
              "Delete",
              "Code",
              "Link",
              "Image",
              "LinkReference",
              "ImageReference",
              "FootnoteReference"
            ]
          },
          "default": [],
          "description": "AST node types this rule processes (empty = all)"
        },
        "isolation_level": {
          "type": "string",
          "enum": [
            "global",
            "block"
          ],
          "default": "global",
          "description": "Rule isolation level: 'global' requires entire document, 'block' can run on individual blocks"
        },
        "languages": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "ja",
              "en",
              "zh",
              "ko"
            ]
          },
          "default": [],
          "description": "Supported languages for this rule"
        },
        "capabilities": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "morphology",
              "sentences"
            ]
          },
          "default": [],
          "description": "Required analysis capabilities: 'morphology' for tokenization, 'sentences' for sentence splitting"
        }
      },
      "additionalProperties": false
    },
    "wasm": {
      "type": "array",
      "items": {
        "type": "object",
        "anyOf": [
          {
            "required": [
              "url",
              "hash"
            ]
          },
          {
            "required": [
              "path",
              "hash"
            ]
          },
          {
            "required": [
              "data",
              "hash"
            ]
          }
        ],
        "properties": {
          "url": {
            "type": "string",
            "format": "uri-reference",
            "description": "WASM file download URL. Use {version} placeholder for version interpolation."
          },
          "path": {
            "type": "string",
            "description": "Local path to WASM file."
          },
          "data": {
            "type": "string",
            "description": "Base64 encoded WASM binary data."
          },
          "hash": {
            "type": "string",
            "pattern": "^[a-fA-F0-9]{64}$",
            "description": "SHA256 hash of the WASM file for integrity verification"
          },
          "method": {
            "type": "string",
            "enum": [
              "GET",
              "HEAD",
              "POST",
              "PUT",
              "PATCH",
              "DELETE",
              "OPTIONS"
            ],
            "description": "HTTP method to use for the request. Must be uppercase."
          },
          "headers": {
            "type": "object",
            "additionalProperties": {
              "type": "string"
            }
          },
          "name": {
            "type": "string"
          }
        }
      },
      "minItems": 1,
      "description": "WASM module sources"
    },
    "allowed_hosts": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "Specifies which hosts may be accessed via HTTP"
    },
    "allowed_paths": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "description": "Specifies which paths should be made available on disk when using WASI. Mapping from path on disk to path inside plugin."
    },
    "memory": {
      "type": "object",
      "properties": {
        "max_pages": {
          "type": "integer",
          "minimum": 0
        },
        "max_http_response_bytes": {
          "type": "integer",
          "minimum": 0
        },
        "max_var_bytes": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "config": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "description": "Config values made accessible using extism_config_get"
    },
    "timeout_ms": {
      "type": "integer",
      "minimum": 1,
      "description": "The plugin timeout in milliseconds"
    },
    "tsuzulint": {
      "type": "object",
      "description": "TsuzuLint compatibility requirements",
      "properties": {
        "min_version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$",
          "description": "Minimum required TsuzuLint version",
          "examples": [
            "0.2.0",
            "1.0.0"
          ]
        }
      },
      "additionalProperties": false
    },
    "options": {
      "type": "object",
      "description": "JSON Schema for rule configuration options. Used by CLI to generate default config.",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
